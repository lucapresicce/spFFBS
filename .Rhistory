usethis::use_gpl3_license()
usethis::use_r("Rcode")
usethis::use_rcpp_armadillo()
usethis::use_package_doc()
usethis::use_rcpp()
devtools::load_all(".")
devtools::document()
devtools::clean_dll()
devtools::document()
Sys.getenv("PATH")
dyn.load("C:/Users/presi/Documents/spFFBS/inst/libs/osqp/build/out/libosqp.dll")
Sys.getenv()
Sys.setenv(RCPP_VERBOSE = 1)
Sys.setenv(RCPP_MAKEVARS_USER = "")
Sys.getenv()
system.file()
system.file("include", package = "RcppArmadillo")
system.file("include", package = "osqp")
system.file("include", package = "osqp")
library(mniw)
library(abind)
library(tictoc)
# -------------------------------
# Synthetic Data Simulation
# -------------------------------
tmax <- 5    # small for quick test
tnew <- 2
n    <- 20
u    <- 10
q    <- 3
p    <- 2
Sigma  <- matrix(c(1, -0.3, 0.6, -0.3, 1.2, 0.4, 0.6, 0.4, 1), q, q)
phi <- 8
tau <- 0.8
a <- (1/tau - 1)
V <- a*diag(n + u)
set.seed(42)
coords <- matrix(runif((n+u)*2), ncol=2)
D <- spBPS::arma_dist(coords)
K <- exp(-phi * D)
W <- rbind(cbind(diag(p), matrix(0, p, n+u)),
cbind(matrix(0, n+u, p), K))
m0 <- matrix(0, n+u + p, q)
C0 <- rbind(cbind(diag(0.005, p), matrix(0, p, n+u)),
cbind(matrix(0, n+u, p), K))
theta0 <- mniw::rMNorm(n = 1, Lambda = m0, SigmaR = C0, SigmaC = Sigma)
G <- array(0, c(n+u+p, n+u+p, tmax+tnew))
theta <- array(0, c(n+u+p, q, tmax+tnew))
for(t in 1:(tmax+tnew)){
G[,,t] <- diag(n+u+p)
theta[,,t] <- if(t==1) G[,,t] %*% theta0 + mniw::rMNorm(1, m0, W, Sigma) else
G[,,t] %*% theta[,,t-1] + mniw::rMNorm(1, m0, W, Sigma)
}
# -------------------------------
# Data generation
# -------------------------------
X <- array(0, c((n+u), p, tmax+tnew))
P <- array(0, c((n+u), (n+u)+p, tmax+tnew))
Y <- array(0, c((n+u), q, tmax+tnew))
for(t in 1:(tmax+tnew)){
P[,,t] <- cbind(X[,,t], diag(n+u))
Y[,,t] <- P[,,t] %*% theta[,,t] + mniw::rMNorm(1, matrix(0, n+u, q), V, Sigma)
}
# Split observed/unobserved
Y_obs <- Y[1:n,,1:tmax]
X_obs <- X[1:n,,]
P_obs <- P[1:n,1:(n+p),]
coords_obs <- coords[1:n,]
Y_unobs <- Y[-(1:n),,]
X_unobs <- X[-(1:n),,]
coords_unobs <- coords[-(1:n),]
# -------------------------------
# Prior
# -------------------------------
# Prior information
m0     <- matrix(0, n+p, q)
C0 <- rbind( cbind(diag(0.005, p), matrix(0, p, n)), cbind(matrix(0, n, p), K[1:n,1:n]) )
nu0 <- 3
Psi0 <- diag(q)
# prior information
prior <- list("m" = m0, "C" = C0, "nu" = nu0, "Psi" = Psi0)
# -------------------------------
# Test new spFFBS() function
# -------------------------------
# Y = Y_obs; G = G[1:(n+p),1:(n+p),]; P = P_obs; D = D[1:n,1:n]; grid = list(tau = c(0.7, 0.8), phi = c(4, 6))
# prior; do_BS = FALSE; do_forecast = FALSE; do_spatial = FALSE; L = 200; tnew = 2
# spatial = list(crd = coords_obs, crdtilde = coords_unobs, Xtilde = X_unobs, t = tmax+tnew)
# internal compute_Wt() is called automatically inside spFFBS()
out <- spFFBS::spFFBS(
Y = Y_obs,
G = G[1:(n+p),1:(n+p),],
P = P[1:n,1:(n+p),],
D = D[1:n,1:n],
grid = list(tau = c(0.8), phi = c(4, 6)),
prior,
do_BS = T,
do_forecast = T,
do_spatial = T,
L = 200,
tnew = 2,
spatial = list(crd = coords_obs, crdtilde = coords_unobs, Xtilde = X_unobs, t = 1)
)
tmax <- 10    # small for quick test
tnew <- 5
n    <- 100
u    <- 50
q    <- 3
p    <- 2
Sigma  <- matrix(c(1, -0.3, 0.6, -0.3, 1.2, 0.4, 0.6, 0.4, 1), q, q)
phi <- 8
tau <- 0.8
a <- (1/tau - 1)
V <- a*diag(n + u)
set.seed(42)
coords <- matrix(runif((n+u)*2), ncol=2)
D <- spBPS::arma_dist(coords)
K <- exp(-phi * D)
W <- rbind(cbind(diag(p), matrix(0, p, n+u)),
cbind(matrix(0, n+u, p), K))
m0 <- matrix(0, n+u + p, q)
C0 <- rbind(cbind(diag(0.005, p), matrix(0, p, n+u)),
cbind(matrix(0, n+u, p), K))
theta0 <- mniw::rMNorm(n = 1, Lambda = m0, SigmaR = C0, SigmaC = Sigma)
G <- array(0, c(n+u+p, n+u+p, tmax+tnew))
theta <- array(0, c(n+u+p, q, tmax+tnew))
for(t in 1:(tmax+tnew)){
G[,,t] <- diag(n+u+p)
theta[,,t] <- if(t==1) G[,,t] %*% theta0 + mniw::rMNorm(1, m0, W, Sigma) else
G[,,t] %*% theta[,,t-1] + mniw::rMNorm(1, m0, W, Sigma)
}
# -------------------------------
# Data generation
# -------------------------------
X <- array(0, c((n+u), p, tmax+tnew))
P <- array(0, c((n+u), (n+u)+p, tmax+tnew))
Y <- array(0, c((n+u), q, tmax+tnew))
for(t in 1:(tmax+tnew)){
P[,,t] <- cbind(X[,,t], diag(n+u))
Y[,,t] <- P[,,t] %*% theta[,,t] + mniw::rMNorm(1, matrix(0, n+u, q), V, Sigma)
}
# Split observed/unobserved
Y_obs <- Y[1:n,,1:tmax]
X_obs <- X[1:n,,]
P_obs <- P[1:n,1:(n+p),]
coords_obs <- coords[1:n,]
Y_unobs <- Y[-(1:n),,]
X_unobs <- X[-(1:n),,]
coords_unobs <- coords[-(1:n),]
# -------------------------------
# Prior
# -------------------------------
# Prior information
m0     <- matrix(0, n+p, q)
C0 <- rbind( cbind(diag(0.005, p), matrix(0, p, n)), cbind(matrix(0, n, p), K[1:n,1:n]) )
nu0 <- 3
Psi0 <- diag(q)
# prior information
prior <- list("m" = m0, "C" = C0, "nu" = nu0, "Psi" = Psi0)
# internal compute_Wt() is called automatically inside spFFBS()
out <- spFFBS::spFFBS(
Y = Y_obs,
G = G[1:(n+p),1:(n+p),],
P = P[1:n,1:(n+p),],
D = D[1:n,1:n],
grid = list(tau = c(0.8), phi = c(4, 6)),
prior,
do_BS = T,
do_forecast = T,
do_spatial = T,
L = 200,
tnew = 2,
spatial = list(crd = coords_obs, crdtilde = coords_unobs, Xtilde = X_unobs, t = 1)
)
tmax <- 10    # small for quick test
tnew <- 5
n    <- 100
u    <- 50
q    <- 3
p    <- 2
Sigma  <- matrix(c(1, -0.3, 0.6, -0.3, 1.2, 0.4, 0.6, 0.4, 1), q, q)
phi <- 8
tau <- 0.8
a <- (1/tau - 1)
V <- a*diag(n + u)
set.seed(42)
coords <- matrix(runif((n+u)*2), ncol=2)
D <- spBPS::arma_dist(coords)
K <- exp(-phi * D)
W <- rbind(cbind(diag(p), matrix(0, p, n+u)),
cbind(matrix(0, n+u, p), K))
m0 <- matrix(0, n+u + p, q)
C0 <- rbind(cbind(diag(0.005, p), matrix(0, p, n+u)),
cbind(matrix(0, n+u, p), K))
theta0 <- mniw::rMNorm(n = 1, Lambda = m0, SigmaR = C0, SigmaC = Sigma)
G <- array(0, c(n+u+p, n+u+p, tmax+tnew))
theta <- array(0, c(n+u+p, q, tmax+tnew))
for(t in 1:(tmax+tnew)){
G[,,t] <- diag(n+u+p)
theta[,,t] <- if(t==1) G[,,t] %*% theta0 + mniw::rMNorm(1, m0, W, Sigma) else
G[,,t] %*% theta[,,t-1] + mniw::rMNorm(1, m0, W, Sigma)
}
# -------------------------------
# Data generation
# -------------------------------
X <- array(0, c((n+u), p, tmax+tnew))
P <- array(0, c((n+u), (n+u)+p, tmax+tnew))
Y <- array(0, c((n+u), q, tmax+tnew))
for(t in 1:(tmax+tnew)){
P[,,t] <- cbind(X[,,t], diag(n+u))
Y[,,t] <- P[,,t] %*% theta[,,t] + mniw::rMNorm(1, matrix(0, n+u, q), V, Sigma)
}
# Split observed/unobserved
Y_obs <- Y[1:n,,1:tmax]
X_obs <- X[1:n,,]
P_obs <- P[1:n,1:(n+p),]
coords_obs <- coords[1:n,]
Y_unobs <- Y[-(1:n),,]
X_unobs <- X[-(1:n),,]
coords_unobs <- coords[-(1:n),]
# -------------------------------
# Prior
# -------------------------------
# Prior information
m0     <- matrix(0, n+p, q)
C0 <- rbind( cbind(diag(0.005, p), matrix(0, p, n)), cbind(matrix(0, n, p), K[1:n,1:n]) )
nu0 <- 3
Psi0 <- diag(q)
# prior information
prior <- list("m" = m0, "C" = C0, "nu" = nu0, "Psi" = Psi0)
# internal compute_Wt() is called automatically inside spFFBS()
out <- spFFBS::spFFBS(
Y = Y_obs,
G = G[1:(n+p),1:(n+p),],
P = P[1:n,1:(n+p),],
D = D[1:n,1:n],
grid = list(tau = c(0.7,0.8), phi = c(4, 6)),
prior,
do_BS = T,
do_forecast = T,
do_spatial = T,
L = 200,
tnew = tnew,
spatial = list(crd = coords_obs, crdtilde = coords_unobs, Xtilde = X_unobs, t = 1)
)
out$Wglobal
out$Wi
